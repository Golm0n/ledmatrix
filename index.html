<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LED Memory Game</title>
<style>
  html, body {
    height: 100%;
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: #111;
    color: #eee;
    font-family: Arial, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  #container {
    display: flex;
    flex-direction: row;
    align-items: flex-start;
    gap: 40px;
    padding: 20px;
  }
  #game {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
  }
  .grid {
    display: grid;
    grid-template-columns: repeat(5, minmax(30px, 6vh));
    grid-template-rows: repeat(5, minmax(30px, 6vh));
    gap: 6px;
  }
  .cell {
    background: #222;
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.25s;
  }
  .cell.on { background: #0f0; }
  .cell.error { background: #f00; }
  .controls {
    display: flex;
    gap: 15px;
    align-items: center;
  }
  .switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 30px;
  }
  .switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }
  .slider {
    position: absolute;
    cursor: pointer;
    top: 0; left: 0; right: 0; bottom: 0;
    background-color: #555;
    transition: 0.4s;
    border-radius: 34px;
  }
  .slider:before {
    position: absolute;
    content: "";
    height: 22px;
    width: 22px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: 0.4s;
    border-radius: 50%;
  }
  input:checked + .slider {
    background-color: #2196F3;
  }
  input:checked + .slider:before {
    transform: translateX(30px);
  }
  #info { max-width: 300px; line-height: 1.5em; }
  #message { font-size: 1.2em; color: #0ff; height: 24px; text-align:center; }
  #hearts span { color: red; font-size: 1.4em; }
</style>
</head>
<body>
<div id="container">
<div id="game">
  <div class="controls">
    <label>Mode :</label>
    <label class="switch">
      <input type="checkbox" id="modeSwitch">
      <span class="slider"></span>
    </label>
    <span id="modeLabel">Missing Light</span>
    <button id="startBtn">Démarrer</button>
  </div>
  <div id="hearts">❤️❤️❤️</div>
  <div id="message"></div>
  <div class="grid" id="grid"></div>
  <div id="score">Score : 0</div>
</div>
<div id="info">
  <h3>Instructions</h3>
  <p>Choisis le mode de jeu :</p>
  <ul>
    <li><b>Missing Light</b> : trouve la LED qui ne s'est jamais allumée.</li>
    <li><b>LED Double</b> : trouve la LED qui s'est allumée deux fois.</li>
  </ul>
  <p>Observe la séquence, puis clique sur la LED correcte.<br>
  - 1ère bonne réponse : +3 points<br>
  - Après relecture : +1 point<br>
  - 3 erreurs = fin du jeu</p>
</div>
</div>
<script>
const grid = document.getElementById('grid');
const startBtn = document.getElementById('startBtn');
const modeSwitch = document.getElementById('modeSwitch');
const modeLabel = document.getElementById('modeLabel');
const message = document.getElementById('message');
const scoreDisplay = document.getElementById('score');
const heartsDisplay = document.getElementById('hearts');

let size = 5;
let lives = 3;
let score = 0;
let currentMode = 'missing';
let sequence1 = [], sequence2 = [];
let correctIndex = null;
let canClick = false;
let alreadyReplayed = false;

function createGrid() {
  grid.innerHTML = '';
  grid.style.gridTemplateColumns = `repeat(${size}, minmax(30px, 6vh))`;
  grid.style.gridTemplateRows = `repeat(${size}, minmax(30px, 6vh))`;
  for (let i = 0; i < size * size; i++) {
    const cell = document.createElement('div');
    cell.classList.add('cell');
    cell.addEventListener('click', () => handleClick(i, cell));
    grid.appendChild(cell);
  }
}

function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

async function flashCells(indices, time = 1000) {
  indices.forEach(i => grid.children[i].classList.add('on'));
  await sleep(time);
  indices.forEach(i => grid.children[i].classList.remove('on'));
}

async function playSequence() {
  canClick = false;
  message.textContent = 'Observation...';
  const total = size * size;
  const allIndices = [...Array(total).keys()];
  const half = Math.floor(total / 2);

  // première vague : moitié des leds aléatoires
  sequence1 = shuffle([...allIndices]).slice(0, half);

  if (currentMode === 'missing') {
    // deuxième vague : moitié - 1 leds non utilisées dans la première vague
    const remaining = allIndices.filter(i => !sequence1.includes(i));
    sequence2 = shuffle([...remaining]).slice(0, half - 1);
    // la LED manquante
    correctIndex = remaining.find(i => !sequence2.includes(i));
  } else {
    // mode double : moitié - 1 leds différentes + une répétée de la première vague
    const remaining = allIndices.filter(i => !sequence1.includes(i));
    sequence2 = shuffle([...remaining]).slice(0, half - 1);
    const dup = sequence1[Math.floor(Math.random() * sequence1.length)];
    sequence2.push(dup);
    correctIndex = dup;
  }

  await flashCells(sequence1, 1200);
  await sleep(300);
  await flashCells(sequence2, 1200);

  message.textContent = 'Clique sur la LED correcte';
  canClick = true;
}

async function handleClick(i, cell) {
  if (!canClick) return;
  if (i === correctIndex) {
    const pts = alreadyReplayed ? 1 : 3;
    score += pts;
    scoreDisplay.textContent = `Score : ${score}`;
    message.textContent = `Correct ! (+${pts})`;
    await sleep(800);
    alreadyReplayed = false;
    playSequence();
  } else {
    if (!alreadyReplayed) {
      message.textContent = 'ERREUR, re-regardez bien la séquence';
      canClick = false;
      await sleep(4000);
      alreadyReplayed = true;
      playSequence();
    } else {
      cell.classList.add('error');
      await sleep(600);
      cell.classList.remove('error');
      grid.children[correctIndex].classList.add('on');
      await sleep(1000);
      grid.children[correctIndex].classList.remove('on');
      lives--;
      heartsDisplay.textContent = '❤️'.repeat(lives);
      if (lives <= 0) {
        message.textContent = `Perdu ! Score final : ${score}`;
        startBtn.disabled = false;
        modeSwitch.disabled = false;
        return;
      }
      alreadyReplayed = false;
      playSequence();
    }
  }
}

modeSwitch.addEventListener('change', () => {
  currentMode = modeSwitch.checked ? 'double' : 'missing';
  modeLabel.textContent = modeSwitch.checked ? 'LED Double' : 'Missing Light';
});

startBtn.addEventListener('click', () => {
  lives = 3;
  score = 0;
  scoreDisplay.textContent = 'Score : 0';
  heartsDisplay.textContent = '❤️❤️❤️';
  modeSwitch.disabled = true;
  startBtn.disabled = true;
  message.textContent = '';
  playSequence();
});

createGrid();
</script>
</body>
</html>
